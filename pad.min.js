function hideUnit(e){var t=document.getElementById(e);return t.style.display="none",!1}function toObject(e){for(var t={},o=0;o<e.length;++o)void 0!==e[o]&&(t[o]=e[o]);return t}function inverObject(e){var t={};for(var o in e)hasOwnProperty.call(e,o)&&(t[e[o]]=o);return t}function convertPosition(e,t){return t*rows+1*e}function convertXY(e,t){return"x"==t?e%rows:"y"==t?Math.floor(e/rows):[e%rows,Math.floor(e/rows)]}function randomColor(e){var t;return 1==e?(t=Math.floor(Math.random()*colors3.length),colors[t]):(t=Math.floor(Math.random()*colors.length),colors[t])}function displayOutput(e,t){"undefined"==typeof t&&(t=0),0==t?document.getElementById("infobooth").innerHTML=e:2==t?document.getElementById("infobooth").innerHTML=e+document.getElementById("infobooth").innerHTML:document.getElementById("infobooth").innerHTML+=e}function toColor(e,t){e=e.toLowerCase(),t=1==t?colors.slice():colors2.slice();for(var o=0;o<colors2.length;o++)if(e==colors2[o].charAt(0))return colors2[o];return 0}function toLetter(e){for(var t=0;t<colors2.length;t++)if(e==colors2[t])return colors2[t].charAt(0);return 0}function getTiles(){divs=document.getElementsByClassName("tile")}function trackScore(e){for(var t=0;t<e.length;t++)scoreTracker[divs[e[t][0]].getAttribute("tileColor")].push([e[t].length])}function clearMemory(e){if("score"==e)for(var t=0;t<colors2.length;t++)scoreTracker[colors2[t]]=[];if("timeout"==e){for(t=0;t<timeOut.length;t++)clearTimeout(timeOut[t]);timeOut=new Array}"arrows"==e&&(document.getElementById("arrowSurface").width=document.getElementById("arrowSurface").width+1,document.getElementById("arrowSurface").width=document.getElementById("arrowSurface").width-1),"ctw"==e&&(ctwTimeOut=new Array)}function capitaliseFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function unCapitaliseFirstLetter(e){return e.charAt(0).toLowerCase()+e.slice(1)}function toggle(e,t){if("timer"==e&&(0==timerOn?(timerOn=1,displayOutput("Timer starts on click (stays on)<br />"),reset(),$("#image4").show(),$("#image5").show()):(timerOn=0,displayOutput("Timer off<br />"),document.getElementById("time").innerHTML="Unlimited",$("#image4").hide(),$("#image5").hide())),"damage"==e&&("none"==document.getElementById("damage").style.display?document.getElementById("damage").style.display="block":document.getElementById("damage").style.display="none"),"draggable"==e){if(2==t)return $(".tile").draggable("option","disabled");1==t?setTimeout(function(){$(".tile").draggable("option","disabled",!1)},5):setTimeout(function(){$(".tile").draggable("option","disabled",!0)},5)}if("skyfall"==e&&(0==skyFall?(skyFall=1,displayOutput("Skyfall enabled.<br /><br />You will now be able to extra turns. Press SkyFall again to disable this. Replays will not save which orbs fall")):(skyFall=0,displayOutput("Skyfall has been disabled"))),"boardcolor"==e){temp23="";var o;for(o=0;o<colors.length;++o)if(capitaliseFirstLetter(colors[o])==t){temp23="1",colors.splice(o,1);break}"1"!=temp23&&colors.push(unCapitaliseFirstLetter(t)),document.getElementById("bc"+t).style.backgroundImage="url('http://pad.dawnglare.com/"+t+temp23+".png')"}"replayarrows"==e&&(0==t?(showReplayArrows=0,displayOutput("Replay Arrows Off")):(showReplayArrows=1,displayOutput("Replay Arrows On")))}function setTileAttribute(e,t,o,r){1!=r&&divs[e].setAttribute("class","tile "+t),divs[e].setAttribute("tileColor",t),divs[e].setAttribute("style","opacity:"+o)}function randomizeBoard(){for(var e=0;rows*cols>e;e++)setTileAttribute(e,randomColor(),1);getTiles();var t=getMatches();0!=t&&randomizeBoard()}function saveBoardState(){for(var e=0;e<divs.length;e++)savedBoardState[e]=divs[e].getAttribute("tileColor")}function loadBoardState(e){for(var t=0;t<divs.length;t++)setTileAttribute(t,e[t],1);getTiles()}function opacify(){for(var e=0;e<divs.length;e++)divs[e].setAttribute("style","opacity:1")}function applyPattern(){var e=document.getElementById("entry").value;if(e=e.replace(new RegExp("\r?\n","g"),""),e.length!=rows*cols)return!1;for(var t,o=0;rows*cols>o;o++)if(t=toColor(e[o]),0==t)return!1;for(var o=0;rows*cols>o;o++)t=toColor(e[o]),setTileAttribute(o,t,1);return!0}function copyPattern(e){for(var t="",o=0;rows*cols>o;o++){if(0==toLetter(divs[o].getAttribute("tileColor")))return!1;t+=toLetter(divs[o].getAttribute("tileColor")).toUpperCase()}document.getElementById("entry").value=t,6!=rows||5!=cols?(displayOutput("<a href='http://pad.dawnglare.com/?height="+cols+"&width="+rows+"&patt="+t+"'>Pattern Link</a><br />",e),replayMoveSet.length>0&&(displayOutput("<a href='http://pad.dawnglare.com/?height="+cols+"&width="+rows+"&patt="+t+"&replay="+replayMoveSet.join("|")+"'>Pattern with Replay Link</a>",1),displayOutput("<br /><a href='http://pad.dawnglare.com/?height="+cols+"&width="+rows+"&patt="+t+"&replay="+replayMoveSet.join("|")+"&drops=1'>Pattern with Replay with Drops Link</a>",1))):($.ajax({async:!1,type:"GET",url:"http://pad.dawnglare.com/s.php?patt="+t+"&replay="+replayMoveSet.join("|"),success:function(e){shortenedShareLink=e},error:function(){ajaxErrorOccured=1}}),1==ajaxErrorOccured?(displayOutput("<a href='http://pad.dawnglare.com/?patt="+t+"'>Pattern Link</a><br />",e),replayMoveSet.length>0&&(displayOutput("<a href='http://pad.dawnglare.com/?patt="+t+"&replay="+replayMoveSet.join("|")+"'>Pattern with Replay Link</a>",1),displayOutput("<br /><a href='http://pad.dawnglare.com/?patt="+t+"&replay="+replayMoveSet.join("|")+"&drops=1'>Pattern with Replay with Drops Link</a>",1)),ajaxErrorOccured=0):(displayOutput("<a href='http://pad.dawnglare.com/?s="+shortenedShareLink+"0'>Pattern Link</a><br />",e),replayMoveSet.length>0&&(displayOutput("<a href='http://pad.dawnglare.com/?s="+shortenedShareLink+"1'>Pattern with Replay Link</a>",1),displayOutput("<br /><a href='http://pad.dawnglare.com/?s="+shortenedShareLink+"2'>Pattern with Replay with Drops Link</a>",1))))}function darkenOrbs(e){for(var t=e[Object.size(e)-1],o=0;o<t.length;o++)setTileAttribute(t[o],"black",0,1);delete e[Object.size(e)-1],timeOut.push(setTimeout(function(){Object.size(e)>0?darkenOrbs(e):requestAction("boardmatched")},dropSpeed))}function changeTheWorld(){changeTheWorldOn=1,1!=freeToPlay&&(start(),ctwTimeOut.push(setTimeout(function(){1==changeTheWorldOn&&(replayMoveSet=[],$(document).trigger("mouseup"),swapHasHappened=1,changeTheWorldOn=0,requestAction("solve",1))},1e4)))}function checkField(){for(var e=0;rows>e;e++)for(var t=0,o=0+e;rows*cols>o;o+=rows)if("black"==divs[rows*cols-1-o].getAttribute("tileColor"))t++;else if(t>0)return!0;return!1}function dropField(){for(var e=0;rows>e;e++)for(var t=0+e;rows*cols>t;t+=rows)rows*(cols-1)>t?"black"==divs[rows*cols-1-t].getAttribute("tileColor")&&$(divs[rows*cols-1-t]).swap($(divs[rows*cols-1-t-rows])):"black"==divs[rows*cols-1-t].getAttribute("tileColor")&&1==skyFall&&setTileAttribute(rows*cols-1-t,randomColor(),1);checkField()?timeOut.push(setTimeout(function(){dropField()},100)):requestAction("fielddropped")}function showDrops(){$("#showDrops").hide(),timeOut.push(setTimeout(function(){swapHasHappened=1,clearMemory("arrows"),opacify(),requestAction("solve",1)},dropSpeed))}function playReplay(e){function t(){timeOut.push(setTimeout(function(){for(var a=0,i=1;r+1>i;i++)i==r&&(a=1),1==showReplayArrows&&canvas_arrow(o,convertXY(replayMoveSet[i-1],"x")*scale+scale/2,convertXY(replayMoveSet[i-1],"y")*scale+scale/2,convertXY(replayMoveSet[i],"x")*scale+scale/2,convertXY(replayMoveSet[i],"y")*scale+scale/2,a);$(divs[replayMoveSet[r-1]]).swap($(divs[replayMoveSet[r]])),r++,r<replayMoveSet.length?t():2==e?showDrops():$("#showDrops").show()},dropSpeed))}if(0!=replayMoveSet.length&&1!=changeTheWorldOn){requestAction("loadboard"),toggle("draggable",0);var o=document.getElementById("arrowSurface").getContext("2d");$(divs[replayMoveSet[0]]).css({opacity:.4});var r=1;t()}}function canvas_arrow(e,t,o,r,a,i){t+=.5,o+=.5,r+=.5,a+=.5;var n=r-t,l=a-o,s=Math.atan2(l,n),c=25;e.strokeStyle="black",e.lineWidth="12",e.beginPath(),e.moveTo(t,o),e.lineTo(.88*(r-t)+t,.88*(a-o)+o),e.stroke(),1==i?e.fillStyle="#cf0":e.fillStyle="white",c=22,e.beginPath(),e.moveTo(r,a),e.lineTo(r-c*Math.cos(s-Math.PI/6),a-c*Math.sin(s-Math.PI/6)),e.lineTo(r-c*Math.cos(s+Math.PI/6),a-c*Math.sin(s+Math.PI/6)),e.closePath(),e.lineWidth="5",e.stroke(),e.fill(),1==i?e.strokeStyle="#cf0":e.strokeStyle="white",e.lineWidth="8",e.beginPath(),e.moveTo(r-.98*(r-t),a-.98*(a-o)),e.lineTo(.88*(r-t)+t,.88*(a-o)+o),e.stroke()}function getMatches(){function e(e,o){for(t(e,o);c.length>0;){var r=c.pop();t(r[0],r[1])}}function t(e,t){o(e,t)||(delete s[convertPosition(e,t)],h.push(convertPosition(e,t))),o(e,t-1)||c.push([e,t-1]),o(e+1,t)||c.push([e+1,t]),o(e,t+1)||c.push([e,t+1]),o(e-1,t)||c.push([e-1,t])}function o(e,t){return 0>e||0>t||e>rows-1||t>cols-1?!0:"undefined"==typeof s[convertPosition(e,t)]?!0:divs[convertPosition(e,t)].getAttribute("tileColor")!=a?!0:!1}for(var r=[],a="",i=[],n=0;cols>n;n++){a="",i=[];for(var l=n*rows;n*rows+rows>l;l++)divs[l].getAttribute("tileColor")!=a&&(i.length>2&&(r=r.concat(i)),a=divs[l].getAttribute("tileColor"),i.length=0),i.push(l),i.length>2&&l==n*rows+rows-1&&(r=r.concat(i))}for(var n=0;rows>n;n++){a="",i=[];for(var l=0+n;rows*cols>l;l+=rows)divs[l].getAttribute("tileColor")!=a&&(i.length>2&&(r=r.concat(i)),a=divs[l].getAttribute("tileColor"),i.length=0),i.push(l),i.length>2&&l>rows*(cols-1)-1&&(r=r.concat(i))}if(0==r.length)return!1;r=toObject(r);for(var s=jQuery.extend({},inverObject(r)),c=[],d=[],h=[],l=0;l<Object.size(r);l++)h=[],"undefined"!=typeof s[r[l]]&&(a=divs[r[l]].getAttribute("tileColor"),"black"!=a&&(e.apply(null,convertXY(r[l])),d.push(h)));return d}function createMonsters(){toLetter(randomColor());var e;e=document.createElement("input"),e.setAttribute("type","text"),e.setAttribute("id","multi"),e.setAttribute("title","Combined Multiplier"),$("#multic").append(e);for(var t=0;myMonsters>t;t++)e=document.createElement("div"),e.setAttribute("id","m"+t),e.setAttribute("class","monster"),$("#damage").append(e);for(var t=0;myMonsters>t;t++)e=document.createElement("input"),e.setAttribute("type","text"),e.setAttribute("id","t"+t),e.setAttribute("class","mtypes"),e.setAttribute("maxlength",2),e.setAttribute("title",toLetter(randomColor(1)).toUpperCase()+toLetter(randomColor(1)).toUpperCase()),$("#m"+t).append(e);for(var t=0;myMonsters>t;t++)e=document.createElement("input"),e.setAttribute("type","text"),e.setAttribute("id","d"+t),e.setAttribute("title","1000"),e.setAttribute("class","mnums"),e.setAttribute("maxlength",4),$("#m"+t).append(e);for(var t=0;myMonsters>t;t++)e=document.createElement("input"),e.setAttribute("type","text"),e.setAttribute("id","r"+t),e.setAttribute("disabled",!0),$("#m"+t).append(e);document.getElementById("damage").style.display="none"}function calculateOutput(e){var t;if("score"==e){var o=0,r="";for(l=0;l<colors2.length;l++)if("undefined"!=typeof scoreTracker[colors2[l]])for(d=0;d<scoreTracker[colors2[l]].length;d++)r+=showComboItems?"<div class='comboInfoBox'><span>"+scoreTracker[colors2[l]][d]+" x </span> <img width='32px' src='http://pad.dawnglare.com/"+capitaliseFirstLetter(colors2[l])+".png'></div>":scoreTracker[colors2[l]][d]+" x "+colors2[l]+"<br />",o++;for(var a="",i="",n=0,l=0;l<scoreTracker.poison.length;l++)n+=20+5*(scoreTracker.poison[l]-3);scoreTracker.poison.length>0&&(a=n+"% life lost due to poison"),replayMoveSet.length>0&&(i="Number of moves: "+(replayMoveSet.length-1)),displayOutput('<div style="float:left">'+r+'</div><div style="float:left;margin-left:20px">Total Combo: '+o+"<br />"+i+"<br />"+a+"</div>",0)}if("damage"==e){for(var s=[],c=0,l=0;l<colors2.length;l++)if("undefined"!=typeof scoreTracker[colors2[l]])for(var d=0;d<scoreTracker[colors2[l]].length;d++)"undefined"==typeof s[colors2[l]]&&(s[colors2[l]]=0),s[colors2[l]]+=(100+25*(1*scoreTracker[colors2[l]][d]-3))/100,c++;var h,p=0;s.x=0,$.isNumeric(h=document.getElementById("multi").value)||(h=0);for(var u,m,f,t=0,l=0;myMonsters>l;l++){f=0;for(var g=document.getElementById("t"+l).value.trim().split(""),y=0;2>y;y++){if(u="undefined"==typeof g[y]?"x":toColor(g[y],1),0==y){if("x"==u||!$.isNumeric(1*document.getElementById("d"+l).value))break;isNaN(s[u])||(f=1*document.getElementById("d"+l).value*s[u]),m=u}1==y&&(t=.3,u==m&&(t=.1),isNaN(s[u])&&(s[u]=0),f=h*((100+25*(c-1))/100)*(f+t*Math.ceil(document.getElementById("d"+l).value)*s[u]),isNaN(f)&&(f=0),f>999999?document.getElementById("r"+l).value=Math.ceil(f/1e4)/100+"m":document.getElementById("r"+l).value=Math.ceil(f),p+=Math.ceil(f))}}document.getElementById("total").value="Total Damage Dealt: "+p}}function solveBoard(e){if(1==e){getTiles();var t=getMatches();0!=t?(trackScore(t),darkenOrbs(t)):(calculateOutput("score"),calculateOutput("damage"),swapHasHappened=0,clearMemory("timeout"),1==skyFall&&toggle("draggable",1))}2==e&&timeOut.push(setTimeout(function(){requestAction("solve")},dropSpeed))}function changeTimer(e){0==e?timerTime>0&&(timerTime-=500):timerTime+=500,reset()}function requestAction(e,t){if("undefined"==typeof t&&(t=0),("randomize"==e||"applypattern"==e&&2!=t)&&(replayMoveSet=[]),("randomize"==e||"loadboard"==e||"clearstate"==e||"copypattern"==e)&&(toggle("draggable",1),changeTheWorldOn=0,swapHasHappened=0,clearMemory("timeout"),clearMemory("ctw"),reset(),clearMemory("arrows"),$("#showDrops").hide()),"randomize"==e&&(colors.length<2?displayOutput("Select a minimum of 2 colors in the options to randomize the board<br />",0):(randomizeBoard(),saveBoardState(),requestAction("copypattern"))),"loadboard"==e&&loadBoardState(savedBoardState),"timer"==e&&(0==changeTheWorldOn?toggle("timer"):displayOutput("Not during Change the World<br />",0)),"damage"==e&&toggle("damage"),"skyfall"==e&&toggle("skyfall"),"changetheworld"==e&&(toggle("draggable",2)?displayOutput("Reset the board first<br />",0):(changeTheWorld(),displayOutput("I want to change the world... <br />",0))),"applypattern"==e&&(applyPattern()?(toggle("draggable",1),saveBoardState(),requestAction("copypattern",0)):displayOutput("Failed to Apply<br />",0)),"copypattern"==e&&(loadBoardState(savedBoardState),copyPattern(t)),"solve"==e&&(0==changeTheWorldOn&&reset(),1==t&&clearMemory("score"),0==changeTheWorldOn&&swapHasHappened?(toggle("draggable",0),solveBoard(1)):clearMemory("timeout"),3==t&&(clearMemory("arrows"),swapHasHappened=1,solveBoard(1))),"convert"==e&&(0==swapHasHappened||1==skyFall)&&timeOut.length<1){var o=document.getElementById("colorfrom").value,r=document.getElementById("colorto").value;if(o.length<1||r.length<1||o.length!=r.length)return;saveBoardState(),requestAction("copypattern");var a=document.getElementById("entry").value;a=a.replace(new RegExp("\r?\n","g"),"");for(var i=a.split(""),n=0,l=a.length;l>n;n++)for(var s=0,c=o.length;c>s;s++)capitaliseFirstLetter(a[n])!=capitaliseFirstLetter(o[s])||(i[n]=capitaliseFirstLetter(r[s]));document.getElementById("entry").value=i.join(""),requestAction("applypattern")}if("boardmatched"==e&&dropField(),("solve2"==e||"fielddropped"==e)&&solveBoard(2),"help"==e){var d=["<a href=\"javascript:requestAction('legend')\">Legend</a> for the color entry box on the right and damage (sword icon at the top)<br /><br />","Icons above the board do things! Gear icon leads to <a href=\"javascript:requestAction('options')\">options</a>",", stopwatch icon toggles an adjustable 4 second timer",'<br /><br />You can play with <a href="http://pad.dawnglare.com/?height=7&width=7">different board sizes</a>! (change url)',"<br /><br />CtW (change the world) allows you to move and drop orbs freely for 10 seconds (no replay)","<br /><br />Convert feature on the right will change all orbs of the first color to those of the second (supports 2 colors at once: GR=>RG)",'<br /><br />Contact me with suggestions at contact@dawnglare.com : <a href="https://github.com/dawnGlare/padsim">GitHub link</a>'].join("");displayOutput(d,0)}if("options"==e){var d=['Options:<br /><div class="test1"><div style="float:left;vertical-align:bottom;line-height:30px">Board Colors: </div>','<button onclick="requestAction(\'boardcolor\', \'Green\')" id="bcGreen" class="topbutton image7">Options</button>','<button onclick="requestAction(\'boardcolor\', \'Red\')" id="bcRed" class="topbutton image8">Options</button>','<button onclick="requestAction(\'boardcolor\', \'Blue\')" id="bcBlue" class="topbutton image9">Options</button>','<button onclick="requestAction(\'boardcolor\', \'Light\')" id="bcLight" class="topbutton image10">Options</button>','<button onclick="requestAction(\'boardcolor\', \'Dark\')" id="bcDark" class="topbutton image11">Options</button>','<button onclick="requestAction(\'boardcolor\', \'Heart\')" id="bcHeart" class="topbutton image12">Options</button></div>','<br />Replayarrows: <a id="myLink" title="toggle replay" href="#" onclick="requestAction(\'replayarrows\', \'1\');">On</a> / <a id="myLink" title="toggle replay" href="#" onclick="requestAction(\'replayarrows\', \'0\');">Off</a>','<br />Show combos with icons: <a onclick="showComboItems = true" href="#">On</a> / <a onclick="showComboItems = false" href="#">Off</a>',"<br /><br />*Board colors affect possible drops from skyfall and colors from random boards"].join("");for(displayOutput(d,0),index1=0;index1<2;++index1)toggle("boardcolor","Blue"),toggle("boardcolor","Green"),toggle("boardcolor","Red"),toggle("boardcolor","Light"),toggle("boardcolor","Dark"),toggle("boardcolor","Heart")}if("boardcolor"==e&&toggle("boardcolor",t),"legend"==e){var d=["Legend:<br />R = Red<br />B = Blue<br />G = Green<br />D = Dark (Purple)<br />L = Light (Yellow)<br />H = Heart<br />J = Jammer<br />P = Poison","<br /><br />Press Enter or hit the apply button to change the board","<br /><br /><a href=\"javascript:requestAction('help')\">Click here to return to information</a>"].join("");displayOutput(d,0)}"replay"==e&&playReplay(toDrop),"showdrops"==e&&showDrops(),"ctimer"==e&&0==changeTheWorldOn&&changeTimer(t),"replayarrows"==e&&toggle("replayarrows",t)}function pad(e,t){var o="0000"+e;return o.substr(o.length-t)}function formatTime(e,t){"undefined"==typeof t&&(t=0);var o,r=ms=0,a="";return e%=36e5,e%=6e4,r=Math.floor(e/1e3),ms=e%1e3,timerOn||changeTheWorldOn?(1==timerOn&&(o=timerTime/1e3),1==changeTheWorldOn&&(o=10),a=pad(Math.floor(o-.01)-r,2)+"."+pad(1e3+timerTime-1e3*Math.floor(timerTime/1e3)-ms,3)+"s",1==t&&(a=pad(Math.floor(o)-r,2)+"."+pad(1e3+timerTime-1e3*Math.floor(timerTime/1e3)-ms,3)+"s"),a):"Unlimited"}function update(){document.getElementById("time").innerHTML=formatTime(x.time())}function start(){clocktimer=setInterval("update()",1),x.start()}function reset(){clearInterval(clocktimer),x.reset(),update(),document.getElementById("time").innerHTML=formatTime(x.time(),1)}var colors=["blue","green","red","light","dark","heart"],colorsbak=["blue","green","red","light","dark","heart"],colors2=["blue","green","red","light","dark","heart","poison","jammer"],colors3=["blue","green","red","light","dark"],divs=[],savedBoardState=[],changeTheWorldOn=0,timerOn=0,dropSpeed=500,scale=90,offsetMargin=0,cornerspace=20,rows=6,cols=5,scoreTracker=[],swapHasHappened=0,timeOut=[],ctwTimeOut=[],myMonsters=6,freeToPlay=0,skyFall=0,showReplayArrows=1,timerTime=4e3,toDrop=0,showComboItems=!0,shortenedData=[],ajaxErrorOccured=0;Object.size=function(e){var t,o=0;for(t in e)e.hasOwnProperty(t)&&o++;return o},jQuery.fn.swap=function(e,t){e=jQuery(e)[0];var o=this[0],r=o.parentNode.insertBefore(document.createTextNode(""),o);return e.parentNode.insertBefore(o,e),r.parentNode.insertBefore(e,r),r.parentNode.removeChild(r),2==t&&(0==swapHasHappened&&replayMoveSet.push((e.offsetTop-e.parentNode.offsetTop-offsetMargin)/scale*rows+(e.offsetLeft-e.parentNode.offsetLeft-offsetMargin)/scale),replayMoveSet.push((o.offsetTop-o.parentNode.offsetTop-offsetMargin)/scale*rows+(o.offsetLeft-o.parentNode.offsetLeft-offsetMargin)/scale)),this};var replayMoveSet=[],clsStopwatch=function(){var e=0,t=0,o=function(){return(new Date).getTime()};this.start=function(){e=e?e:o()},this.reset=function(){t=e=0},this.time=function(){return t+(e?o()-e:0)}},x=new clsStopwatch,clocktimer;$(function(){for(var e={},t=location.search.substr(1).split(/&/),o=0;o<t.length;++o){var r=t[o].split(/=/);""!=r[0]&&(e[decodeURIComponent(r[0])]=decodeURIComponent(r.slice(1).join("").replace("+"," ")))}e.width&&$.isNumeric(e.width)&&2<e.width&&e.width<10&&(rows=parseInt(e.width),document.getElementById("board").style.width=rows*scale+"px"),e.height&&$.isNumeric(e.height)&&2<e.height&&e.height<10&&(cols=parseInt(e.height),document.getElementById("board").style.height=cols*scale+"px"),(6!=rows||5!=cols)&&(document.getElementById("entry").maxLength=cols*rows,document.getElementById("entry").style.width=70*rows/6+"px",document.getElementById("entry").style.height=120*cols/5+"px");for(var o=0;rows*cols>o;o++){var a=randomColor();divs[o]=document.createElement("div"),setTileAttribute(o,a,1),$("#tiles").append(divs[o])}for(o=1;rows>o;o++)for(h=1;h<cols;h++)$("#board").append("<div class='cornerblock' style='left:"+(scale*o-cornerspace/2)+"px;top:"+(scale*h-cornerspace/2)+"px'></div>");if(randomizeBoard(),createMonsters(),saveBoardState(),clearMemory("score"),e.s){var i=e.s.substr(e.s.length-1);$.ajax({async:!1,type:"GET",url:"http://pad.dawnglare.com/l.php?link="+e.s.slice(0,-1),success:function(e){shortenedData=e.split("~")}}),shortenedData.length>0&&0==shortenedData[0].length&&alert("The map you were looking for couldn't be found")}if(shortenedData.length>0&&shortenedData[0].length>0){if(document.getElementById("entry").innerHTML=shortenedData[0],i>0)for(2==i&&(toDrop=2),replayMoveSet=shortenedData[1].split("|"),o=0;o<replayMoveSet.length;o++)if(replayMoveSet[o]>29||replayMoveSet[o]<0){replayMoveSet=[];break}requestAction("applypattern",2)}else if(e.patt){if(document.getElementById("entry").innerHTML=e.patt,e.replay)for(replayMoveSet=e.replay.split("|"),o=0;o<replayMoveSet.length;o++)if(replayMoveSet[o]>rows*cols-1||replayMoveSet[o]<0){replayMoveSet=[];break}requestAction("applypattern",2)}else requestAction("copypattern",0);replayMoveSet.length>0&&timeOut.push(setTimeout(function(){requestAction("replay")},1e3)),e.freetoplay&&(freeToPlay=1),e.timer&&(timerTime=1e3*e.timer),e.drops&&(toDrop=2),e.speed&&$.isNumeric(e.speed)&&(dropSpeed=e.speed),requestAction("help"),$(function(){document.getElementById("time").innerHTML=formatTime(x.time())}),$(".tile").draggable({refreshPositions:"true",containment:"#board",helper:"clone",opacity:.8,start:function(e,t){$(this).css({opacity:.2}),clearMemory("arrows"),replayMoveSet=[],0==changeTheWorldOn&&1==timerOn&&(timeOut.push(setTimeout(function(){$(document).trigger("mouseup")},timerTime)),start())},stop:function(e,t){$(this).css({opacity:1}),requestAction("solve",1)},cursorAt:{top:scale/2,left:scale/2}}),$(".tile").droppable({accept:".tile",over:function(e,t){var o=t.draggable,r=$(this);1==skyFall&&0==swapHasHappened&&saveBoardState(),o.swap(r,2),swapHasHappened=1}}),$(".cornerblock").droppable({tolerance:"pointer",over:function(e,t){var o=0;$(".tile").each(function(){o++<30&&$(this).droppable("option","disabled",!0)})},out:function(e,t){var o=0;$(".tile").each(function(){o++<30&&$(this).droppable("option","disabled",!1)})}}),$("#entry").bind({keydown:function(e){return 13==e.which&&requestAction("applypattern"),82==e.which||71==e.which||66==e.which||76==e.which||68==e.which||72==e.which||80==e.which||74==e.which||46==e.which||8==e.which||37==e.which||38==e.which||39==e.which||40==e.which||e.ctrlKey&&(65==e.which||86==e.which||67==e.which)?!0:!1}}),$("#colorfrom").bind({keydown:function(e){return 13==e.which&&requestAction("convert"),82==e.which||71==e.which||66==e.which||76==e.which||68==e.which||72==e.which||80==e.which||74==e.which||46==e.which||8==e.which||37==e.which||38==e.which||39==e.which||40==e.which||e.ctrlKey&&(65==e.which||86==e.which||67==e.which)?!0:!1}}),$("#colorto").bind({keydown:function(e){return 13==e.which&&requestAction("convert"),82==e.which||71==e.which||66==e.which||76==e.which||68==e.which||72==e.which||80==e.which||74==e.which||46==e.which||8==e.which||37==e.which||38==e.which||39==e.which||40==e.which||e.ctrlKey&&(65==e.which||86==e.which||67==e.which)?!0:!1}}),$("#multi").bind({keydown:function(e){return e.which>47&&e.which<58||110==e.which||190==e.which||8==e.which||46==e.which||37==e.which||38==e.which||39==e.which||40==e.which||e.which>=96&&e.which<=105?!0:!1}}),$(".mtypes").bind({keydown:function(e){return 9==e.which||82==e.which||71==e.which||66==e.which||76==e.which||68==e.which||80==e.which||74==e.which||46==e.which||8==e.which||37==e.which||38==e.which||39==e.which||40==e.which?!0:!1}}),$(".mnums").bind({keydown:function(e){return e.which>47&&e.which<58||8==e.which||9==e.which||46==e.which||37==e.which||38==e.which||39==e.which||40==e.which||e.which>=96&&e.which<=105?!0:!1}})}),$(document).ready(function(){$("input[type=text][title],input[type=password][title],textarea[title]").each(function(e){$(this).addClass("input-prompt-"+e);var t=$('<span class="input-prompt"/>');$(t).attr("id","input-prompt-"+e),$(t).append($(this).attr("title")),$(t).click(function(){$(this).hide(),$("."+$(this).attr("id")).focus()}),""!=$(this).val()&&$(t).hide(),$(this).after(t),$(this).focus(function(){$("#input-prompt-"+e).hide()}),$(this).blur(function(){""==$(this).val()&&$("#input-prompt-"+e).show()})})});